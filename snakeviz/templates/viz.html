<!doctype html>
<html>
  <head>
    <meta charset="utf-8" .>
    <title>{{profile_name.split('/')[-1].split('.')[0]}}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/static/snakeviz.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="/static/vendor/jquery.dataTables.min.css" rel="stylesheet">

    <!-- Mouse-over tooltip -->
    <link href="/static/tooltip/tooltip.css" rel="stylesheet">

    <script>
      var table_data = {% raw table_rows %};
      var profile_data = {% raw callees %};
    </script>
  </head>

  <body>
    <h1 id="snakeviz-text">SnakeViz</h1>
    <button id="resetbutton" disabled="True">
            Reset
    </button>
    <select name="sv-depth" id="sv-depth-select">
      {% for i in range(5, 21, 5) %}
        <option value="{{i}}" {% if i == 10 %}selected{% end %}>{{i}}</option>
      {% end %}
    </select>
    <div style="text-align: center;">
      <div id="chart"></div>
    </div>
    <br>
    <div id="table_div">
      <table cellpadding="0" cellspacing="0" border="0" class="display" id="pstats-table">
      </table>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/static/vendor/jquery-1.11.1.min.js"></script>
    <script src="/static/vendor/d3.min.js"></script>
    <script src="/static/vendor/jquery.dataTables.min.js"></script>
    <script src="/static/vendor/lodash.compat.min.js"></script>
    <script src="/static/vendor/immutable.min.js"></script>
    <script src='/static/snakeviz.js'></script>
    <script src="/static/tooltip/tooltip.js"></script>
    <script src='/static/viz/sunburst.js'></script>

    <script>
      // Make the stats table
      $(document).ready(function() {
        $('#pstats-table').dataTable({
          'data': table_data,
          'columns': [
            {'title': 'ncalls', 'type': 'num', 'searchable': 'false'},
            {'title': 'tottime', 'type': 'num', 'searchable': 'false'},
            {'title': 'percall', 'type': 'num', 'searchable': 'false'},
            {'title': 'cumtime', 'type': 'num', 'searchable': 'false'},
            {'title': 'percall', 'type': 'num', 'searchable': 'false'},
            {'title': 'filename:lineno(function)'}
          ],
          'order': [1, 'desc'],
          'paging': false
        });
      });
      // Make the visualization
      $(document).ready(function () {
        sv_root_func_name = sv_find_root(profile_data);
        sv_call_stack = [sv_root_func_name];
        sv_base_size = 1000;
        sv_root_heirarchy = sv_build_heirarchy(
          profile_data, sv_root_func_name, sv_heirarchy_depth(), sv_base_size);
        drawSunburst(sv_root_heirarchy);
      });
    </script>
  </body>
</html>
